df_known <- read.csv("R data.csv", header = TRUE)
View(R.data)
View(R.data)
names(df_known) <- as.character(unlist(df_known[1, ]))
# Remove row 1 from the data
df_known <- df_known[-1, ]
# Convert year column to numeric (important!)
df_known$year <- as.numeric(df_known$year)
# Check the result
print(names(df_known))
print(head(df_known))
print(names(df_known))
print(head(df_known))
df <- read.csv("R data.csv")
df <- read.csv("/home/daydreamer/Documents/EuroMonitor/R scripts/R data.csv")
View(df)
df_long <- df %>%
pivot_longer(cols = starts_with("X"), names_to = "Year", values_to = "Value") %>%
mutate(Year = as.numeric(str_remove(Year, "X")))
library(tidyverse)
library(forecast)
library(forecast)
install.packages("forecast")
rm(list = ls())
library(tidyverse)
library(forecast)
df <- read.csv("/home/daydreamer/Documents/EuroMonitor/R scripts/R data.csv")
df_long <- df %>%
pivot_longer(cols = starts_with("X"), names_to = "Year", values_to = "Value") %>%
mutate(Year = as.numeric(str_remove(Year, "X")))
# For each age group & indicator
forecast_ts <- function(known_vals, start_year = 2014, end_year_backcast = 1995) {
ts_data <- ts(known_vals, start = start_year, frequency = 1)
fit <- auto.arima(ts_data)
fcast <- forecast(fit, h = start_year - end_year_backcast)
rev(as.numeric(fcast$mean))  # reversed for backcasting
}
# Apply to each group
results <- df_long %>%
group_by(Indicator, Units) %>%
filter(!is.na(Value), Year >= 2014) %>%
summarise(backcast_vals = list(forecast_ts(Value))) %>%
unnest_wider(backcast_vals, names_sep = "_")
View(results)
View(results)
# Function: backcast 1995–2013 using 2014–2025
backcast_series <- function(known_vals, start_year = 2014) {
ts_data <- ts(rev(known_vals), start = start_year, frequency = 1)
fit <- auto.arima(ts_data)
fcast <- forecast(fit, h = start_year - 1995)
rev(as.numeric(fcast$mean))  # years 1995–2013
}
# Apply per indicator
backcast_results <- df_long %>%
group_by(Indicator, Units) %>%
filter(Year >= 2014, !is.na(Value)) %>%
summarise(backcast = list(backcast_series(Value)), .groups = "drop") %>%
mutate(Year = map(backcast, ~ 1995:2013)) %>%
unnest(c(backcast, Year))
# Merge back into original data
df_complete <- df_long %>%
left_join(backcast_results, by = c("Indicator", "Units", "Year")) %>%
mutate(Value = ifelse(is.na(Value) & Year < 2014, backcast, Value)) %>%
select(-backcast)
# View backcast for active & unemployed categories
df_complete %>%
filter(Indicator %in% c("Economically active population", "Unemployed population")) %>%
pivot_wider(names_from = Year, values_from = Value) %>%
print(n = 50)
View(df_complete)
print(result, row.names = FALSE)
library(tidyverse)
library(forecast)
# Known rates 2014–2024
rates_known <- c(0.58695, 0.58486, 0.58347, 0.58843, 0.58923, 0.58922, 0.57505, 0.56757, 0.57766, 0.58687, 0.58688)
years_known <- 2014:2024
# Backcast rate to 1995
ts_rate <- ts(rates_known, start = 2014, frequency = 1)
fit_rate <- auto.arima(ts_rate)
backcast_rate <- rev(as.numeric(forecast(fit_rate, h = 2014 - 1995)$mean))
# Total population 1995–2013
total_1995_2013 <- c(
8174.231, 8280.638, 8384.901, 8431.161, 8504.027, 8587.420, 8665.661,
8724.998, 8763.753, 8795.026, 8827.987, 8859.815, 8893.008, 8921.481,
8941.152, 8965.425, 8980.498, 8954.029, 8926.573
)
years_1995_2013 <- 1995:2013
# Combine
result <- data.frame(
Year = c(years_1995_2013, years_known),
Total = c(total_1995_2013, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA),
Rate = c(backcast_rate, rates_known),
Active = c(total_1995_2013 / backcast_rate, rep(NA, 11))
)
print(result, row.names = FALSE)
View(result)
View(result)
rm(list = ls())
print(result, row.names = FALSE)
library(tidyverse)
library(forecast)
# Known rates 2014–2024
rates_known <- c(0.58695, 0.58486, 0.58347, 0.58843, 0.58923, 0.58922,
0.57505, 0.56757, 0.57766, 0.58687, 0.58688)
# Fit ARIMA to known rates
ts_rate <- ts(rates_known, start = 2014, frequency = 1)
fit <- auto.arima(ts_rate)
# Backcast 1995–2013 with smoother trend
backcast_rate <- rev(as.numeric(forecast(fit, h = 2014 - 1995)$mean))
# Apply to your totals
total_1995_2013 <- c(8174.231, 8280.638, 8384.901, 8431.161, 8504.027,
8587.420, 8665.661, 8724.998, 8763.753, 8795.026,
8827.987, 8859.815, 8893.008, 8921.481, 8941.152,
8965.425, 8980.498, 8954.029, 8926.573)
result <- data.frame(
Year = 1995:2013,
Total = total_1995_2013,
Rate = backcast_rate,
Active = total_1995_2013 / backcast_rate
)
print(result, row.names = FALSE)
View(result)
library(tidyverse)
library(forecast)
rates_known <- c(0.58695, 0.58486, 0.58347, 0.58843, 0.58923, 0.58922,
0.57505, 0.56757, 0.57766, 0.58687, 0.58688)
# Fit linear trend model (tends to change more over time)
ts_rate <- ts(rates_known, start = 2014)
fit <- tslm(ts_rate ~ trend)  # linear trend
# Backcast
trend_vals <- seq(from = 2014 - 19, to = 2014 - 1, by = 1)
backcast_rate <- forecast(fit, newdata = data.frame(trend = trend_vals))
backcast_rate <- rev(as.numeric(backcast_rate$mean))
# Apply
total_1995_2013 <- c(8174.231, 8280.638, 8384.901, 8431.161, 8504.027,
8587.420, 8665.661, 8724.998, 8763.753, 8795.026,
8827.987, 8859.815, 8893.008, 8921.481, 8941.152,
8965.425, 8980.498, 8954.029, 8926.573)
result <- data.frame(
Year = 1995:2013,
Total = total_1995_2013,
Rate = backcast_rate,
Active = total_1995_2013 / backcast_rate
)
print(result, row.names = FALSE)
View(result)
print(result, row.names = FALSE)
rate_1995 <- 0.59  # Slightly higher than 0.58695
rate_2014 <- 0.58695
years <- 1995:2014
rates_interp <- seq(rate_1995, rate_2014, length.out = 20)  # 1995–2014
result <- data.frame(
Year = 1995:2013,
Rate = rates_interp[1:19],
Active = total_1995_2013 / rates_interp[1:19]
)
print(result, row.names = FALSE)
View(result)
print(result, row.names = FALSE)
library(tidyverse)
library(forecast)
# Known data 2014–2024
df <- data.frame(
year = 2014:2024,
rate = c(0.58695, 0.58486, 0.58347, 0.58843, 0.58923, 0.58922,
0.57505, 0.56757, 0.57766, 0.58687, 0.58688),
gdp = c(0.7, 1.6, 2.0, 3.3, 2.9, 2.7, -8.2, 5.6, 7.0, 2.6, 1.9),
pop = c(-0.5, -0.35, -0.23, -0.15, -0.05, 0.17, 0.26, 0.2, 0.25, 0.13, -0.05)
)
# Historical predictors 1995–2013
hist <- data.frame(
year = 1995:2013,
gdp = c(2.3, 3.5, 4.4, 4.8, 3.9, 3.8, 1.9, 0.8, -0.9, 1.8, 0.8,
1.6, 2.5, 0.3, -3.1, 1.7, -1.7, -4.1, -1.0),
pop = c(0.33, 0.36, 0.43, 0.48, 0.54, 0.67, 0.69, 0.57, 0.4, 0.26,
0.21, 0.2, 0.22, 0.16, 0.12, 0.02, -0.2, -0.42, -0.52)
)
# Fit ARIMAX model
fit_arimax <- auto.arima(df$rate, xreg = cbind(df$gdp, df$pop))
# Predict 1995–2013 using historical GDP/pop
pred <- forecast(fit_arimax, xreg = cbind(hist$gdp, hist$pop))
pred_rates <- as.numeric(pred$mean)
result <- data.frame(
Year = 1995:2013,
Labor_Participation_Rate = pred_rates
)
print(result, row.names = FALSE)
View(result)
View(df)
View(fit_arimax)
View(hist)
View(result)
# Known unemployment rates 2014–2024
unemp_rates <- c(13.88, 12.405, 11.058, 8.878, 6.966, 6.422,
6.85, 6.712, 6.138, 6.498, 6.427)  # 2014 to 2024
# Fit ARIMAX for unemployment rate
fit_unemp <- auto.arima(unemp_rates, xreg = cbind(gdp, pop))
library(tidyverse)
library(forecast)
# KNOWN 2014–2024
known_years <- 2014:2024
lab_rate_known <- c(0.58695, 0.58486, 0.58347, 0.58843, 0.58923, 0.58922,
0.57505, 0.56757, 0.57766, 0.58687, 0.58688)
unemp_rate_known <- c(13.88, 12.405, 11.058, 8.878, 6.966, 6.422,
6.85, 6.712, 6.138, 6.498, 6.427)
gdp_known <- c(0.7, 1.6, 2.0, 3.3, 2.9, 2.7, -8.2, 5.6, 7.0, 2.6, 1.9)
pop_known <- c(-0.5, -0.35, -0.23, -0.15, -0.05, 0.17, 0.26, 0.2, 0.25, 0.13, -0.05)
# HISTORICAL 1995–2013
hist_years <- 1995:2013
gdp_hist <- c(2.3, 3.5, 4.4, 4.8, 3.9, 3.8, 1.9, 0.8, -0.9, 1.8, 0.8,
1.6, 2.5, 0.3, -3.1, 1.7, -1.7, -4.1, -1.0)
pop_hist <- c(0.33, 0.36, 0.43, 0.48, 0.54, 0.67, 0.69, 0.57, 0.4, 0.26,
0.21, 0.2, 0.22, 0.16, 0.12, 0.02, -0.2, -0.42, -0.52)
# ARIMAX for Labour Participation Rate
fit_lab <- auto.arima(lab_rate_known, xreg = cbind(gdp_known, pop_known))
pred_lab <- forecast(fit_lab, xreg = cbind(gdp_hist, pop_hist))
lab_pred <- as.numeric(pred_lab$mean)
# ARIMAX for Unemployment Rate
fit_unemp <- auto.arima(unemp_rate_known, xreg = cbind(gdp_known, pop_known))
pred_unemp <- forecast(fit_unemp, xreg = cbind(gdp_hist, pop_hist))
unemp_pred <- as.numeric(pred_unemp$mean)
# Results
results <- data.frame(
Year = hist_years,
Labour_Participation_Rate = round(lab_pred, 5),
Unemployment_Rate = round(unemp_pred, 3)
)
print(results, row.names = FALSE)
View(pred_lab)
View(results)
write.csv(results, "predicted_rates_1995_2013.csv", row.names = FALSE)
# Write to CSV
write.csv(result, "lfpr_65_backcast.csv", row.names = FALSE)
# Create years 1995-2014
years <- 1995:2014
# Start and end points (Option 2 values)
start_1995 <- 0.04000
end_2014 <- 0.11070
# Calculate straight line
lfpr_65 <- start_1995 + (end_2014 - start_1995) * (years - 1995) / (2014 - 1995)
# Round to 5 decimals
lfpr_65 <- round(lfpr_65, 5)
# Create data frame
result <- data.frame(Year = years, LFPR_65 = lfpr_65)
print(result)
# Write to CSV
write.csv(result, "lfpr_65_backcast.csv", row.names = FALSE)
# ============================================
# 15-24 LFPR Backcast for Portugal (1995-2013)
# ============================================
# Create years
years <- 1995:2014
# Define anchor points based on historical context
# Key events: Education expansion (steady decline) + 2008 crisis (sharp drop)
anchors_1524 <- data.frame(
year = c(1995, 2000, 2008, 2013, 2014),
# Historical reasoning:
# 1995: High participation (less education) - 0.48-0.52
# 2000: Education expansion continues - 0.44-0.48
# 2008: Pre-crisis, still declining - 0.40-0.42
# 2013: Post-crisis recovery - should be near 2014 value
# 2014: Your actual data - 0.34427
rate = c(0.48000, 0.46000, 0.41000, 0.34500, 0.34427)
)
# Linear interpolation between anchors
lfpr_1524 <- approx(anchors_1524$year, anchors_1524$rate,
xout = years, method = "linear")$value
# Round to 5 decimals
lfpr_1524 <- round(lfpr_1524, 5)
# Create years
years <- 1995:2014
# Define anchor points based on historical context
# Key events: Education expansion (steady decline) + 2008 crisis (sharp drop)
anchors_1524 <- data.frame(
year = c(1995, 2000, 2008, 2013, 2014),
# Historical reasoning:
# 1995: High participation (less education) - 0.48-0.52
# 2000: Education expansion continues - 0.44-0.48
# 2008: Pre-crisis, still declining - 0.40-0.42
# 2013: Post-crisis recovery - should be near 2014 value
# 2014: Your actual data - 0.34427
rate = c(0.48000, 0.46000, 0.41000, 0.34500, 0.34427)
)
# Linear interpolation between anchors
lfpr_1524 <- approx(anchors_1524$year, anchors_1524$rate,
xout = years, method = "linear")$value
# Round to 5 decimals
lfpr_1524 <- round(lfpr_1524, 5)
# ============================================
# 15-24 LFPR Backcast for Portugal (1995-2013)
# Simple R Code
# ============================================
# Create years 1995-2014
years <- 1995:2014
# Define anchor points for 15-24 group
anchors <- data.frame(
year = c(1995, 2000, 2008, 2013, 2014),
rate = c(0.48000, 0.46000, 0.41000, 0.34500, 0.34427)
)
# Linear interpolation between anchors
lfpr_1524 <- approx(anchors$year, anchors$rate,
xout = years, method = "linear")$value
# Round to 5 decimals
lfpr_1524 <- round(lfpr_1524, 5)
# ============================================
# 15-24 Group - EXACT SAME METHOD as 65+
# Straight line from start to end
# ============================================
years <- 1995:2014
# Start and end points
start_1995 <- 0.48000    # Your choice - high in 1995
end_2014 <- 0.34427      # Your actual 2014 value
# Straight line calculation
lfpr_1524 <- start_1995 + (end_2014 - start_1995) * (years - 1995) / (2014 - 1995)
# Round to 5 decimals
lfpr_1524 <- round(lfpr_1524, 5)
# Create table
result <- data.frame(Year = years, LFPR_15_24 = lfpr_1524)
print(result)
write.csv(result, "lfpr_15_24_simple_line.csv", row.names = FALSE)
# R approach (tidyverse)
library(tidyverse)
setwd(dirname(rstudioapi::getActiveDocumentContext()$path))
df <- read_csv("ECOMM_Sales_Data.csv")
# Quick analysis
df %>%
filter(Sales > 0) %>%
group_by(Category, Region) %>%
summarise(Total = sum(Sales)) %>%
ggplot(aes(Category, Total, fill = Region)) +
geom_col()
df.summary()
smarry(df)
sumarry(df)
summary(df)
df %>%
filter(Sales > 0) %>%
group_by(Category, Product Name) %>%
df %>%
filter(Sales > 0) %>%
group_by(Category, 'Product Name') %>%
summarise(Total = sum(Sales)) %>%
ggplot(aes(Category, Total, fill = Region)) +
geom_col()
# Quick analysis
df %>%
filter(Sales > 0) %>%
group_by(Category, 'Product Name') %>%
summarise(Total = sum(Sales)) %>%
ggplot(aes(Category, Total, fill = Region)) +
geom_col()
# Quick analysis
df %>%
filter(Sales > 0) %>%
group_by(Category, 'Product Name') %>%
summarise(Total = sum(Sales)) %>%
ggplot(aes(Category, Total, fill = 'Product Name')) +
geom_col()
View(df)
View(df)
PFM <- df %>%
group_by(month) %>%
summarise(total_sum = sum(Profit)) %>%
arrange(desc(total_sum))
View(df)
df <- df %>%
mutate(month = format(as.Date('Order Date'),"%Y-%m"))
df <- df %>%
mutate(month = format(as.Date('Order Date', format = "%Y-%m-%d"),"%Y-%m"))
head(df$`Order Date`, 5)
str(df$`Order Date`)
df <- df %>%
mutate(month = format(`Order Date`, "%Y-%m"))
PFM <- df %>%
group_by(month) %>%
summarise(total_sum = sum(Profit)) %>%
arrange(desc(total_sum))
View(df)
View(PFM)
df <- df %>%
mutate(month = format(`Order Date`, "%m"))
View(df)
PFM <- df %>%
group_by(month) %>%
summarise(total_sum = sum(Profit)) %>%
arrange(desc(total_sum))
View(PFM)
top3 <- head(PFM,3)
print(top3)
ggplot(top3, aes(x = reorder(month, - total_sum), y = total_sum)) +
geom_col(fill = 'darkgreen') +
labs(title = ' Top 3 Most Active Months',x = "Month", y = 'Total Profit') +
theme_minimal()
ggplot(top3, aes(x = reorder(month, - total_sum), y = total_sum)) +
geom_col(fill = 'darkgreen') +
labs(title = ' Top 3 Most Active Months',x = "Month", y = 'Total Profit') +
theme_classic()
top <- head(PFM,5)
ggplot(top, aes(x = reorder(month, - total_sum), y = total_sum)) +
geom_col(fill = 'darkgreen') +
labs(title = ' Top Most Active Months',x = "Month", y = 'Total Profit') +
theme_classic()
ggplot(bot, aes(x = reorder(month, - total_sum), y = total_sum)) +
geom_col(fill = 'red') +
labs(title = ' Least Profitable Months', x = "Month", y = 'Total Profit') +
theme_minimal()
bot <- tail(PFM,3)
ggplot(bot, aes(x = reorder(month, - total_sum), y = total_sum)) +
geom_col(fill = 'red') +
labs(title = ' Least Profitable Months', x = "Month", y = 'Total Profit') +
theme_minimal()
top <- head(PFM,3)
bot <- tail(PFM,3)
combined <- bind_rows(
top %>% mutate(type = "Top 3"),
bot %>% mutate(type = "Bottom 3")
)
ggplot(combined, aes(x = reorder(month, -total_sum), y = total_sum, fill = type)) +
geom_col() +
scale_fill_manual(values = c("Top 3" = "darkgreen", "Bottom 3" = "red")) +
labs(title = "Top vs Bottom Profitable Months", x = "Month", y = "Total Profit") +
theme_minimal() +
facet_wrap(~type, scales = "free_x")
ggplot(combined, aes(x = reorder(month, -total_sum), y = total_sum, fill = type)) +
geom_col() +
scale_fill_manual(values = c("Top 3" = "darkgreen", "Bottom 3" = "darkred")) +
labs(title = "Top vs Bottom Profitable Months", x = "Month", y = "Total Profit") +
theme_minimal() +
facet_wrap(~type, scales = "free_x")
View(top)
View(top)
View(top3)
names(df)
MS <- df %>%
group_by(month) %>%
summarise(totalCount = count("Product Name")) %>%
arrange(desc(totalCount))
MS <- df %>%
group_by(month, 'Product Name') %>%
summarise(totalSold = sum(Quantity, na.rm = TRUE)) %>%
arrange(desc(totalSold))
View(MS)
MS <- df %>%
group_by(month, "Product Name") %>%
summarise(totalSold = sum(Quantity, na.rm = TRUE)) %>%
arrange(desc(totalSold))
MS <- df %>%
group_by(month, `Product Name`) %>%
summarise(totalSold = sum(Quantity, na.rm = TRUE)) %>%
arrange(desc(totalSold))
print(head(MS,5))
print(head(MS,10))
MStop <- MS %>%
group_by(month) %>%
slice_max(totalSold, n = 1)
print(MS_top)
print(MStop)
MStop <- MS %>%
group_by(month) %>%
slice_max(totalSold, n = 1) %>%
arrange(asc(totalSold))
MStop <- MS %>%
group_by(month) %>%
slice_max(totalSold, n = 1) %>%
arrange((totalSold))
print(MStop)
MStop <- MS %>%
group_by(month) %>%
slice_max(totalSold, n = 1) %>%
arrange(desc(totalSold))
print(MStop)
ggplot(MS_top, aes(x = month, y = totalSold, fill = `Product Name`)) +
geom_col() +
geom_text(aes(label = totalSold), vjust = -0.5) +
labs(title = "Most Sold Product Each Month", x = "Month", y = "Quantity") +
theme_minimal()
ggplot(MStop, aes(x = month, y = totalSold, fill = `Product Name`)) +
geom_col() +
geom_text(aes(label = totalSold), vjust = -0.5) +
labs(title = "Most Sold Product Each Month", x = "Month", y = "Quantity") +
theme_minimal()
ggplot(MStop, aes(x = month, y = totalSold, fill = `Product Name`)) +
geom_col() +
geom_text(aes(label = `Product Name`), angle = 90, hjust = 1.1, size = 3, color = "white") +
labs(title = "Most Sold Product Each Month", x = "Month", y = "Quantity") +
theme_minimal()
ggplot(MStop, aes(x = month, y = totalSold, fill = `Product Name`)) +
geom_col() +
geom_text(angle = 90, hjust = 1.1, size = 3, color = "white") +
labs(title = "Most Sold Product Each Month", x = "Month", y = "Quantity") +
theme_minimal()
ggplot(MStop, aes(x = month, y = totalSold, fill = `Product Name`)) +
geom_col() +
geom_text(aes(label = `Product Name`), angle = 90, hjust = 1.1, size = 3, color = "white") +
labs(title = "Most Sold Product Each Month", x = "Month", y = "Quantity") +
theme_minimal()
ggplot(MStop, aes(x = month, y = totalSold, fill = `Product Name`)) +
geom_col() +
geom_text(aes(label = totalSold), vjust = -0.5) +
labs(title = "Most Sold Product Each Month", x = "Month", y = "Quantity") +
theme_minimal()
unique_products <- unique(df$`Product Name`)
print(unique_products)
# Count of each product
productcounts <- df %>%
count(`Product Name`, sort = TRUE)
print(productcounts)
ggplot(productcounts, aes(x = reorder(`Product Name`, -n), y = n)) +
geom_col(fill = "steelblue") +
labs(title = "Total Sales per Product", x = "Product", y = "Count") +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
